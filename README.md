####Promise shim for both browser and node use